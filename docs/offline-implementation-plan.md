# å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œå®Ÿè£…è¨ˆç”»

**badwave-mobile ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾çŠ¶

badwave-mobile ã¯éŸ³æ¥½ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ»å†ç”Ÿã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€ç¾åœ¨**57%ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½å®Œæˆåº¦**ã‚’é”æˆã—ã¦ã„ã¾ã™ã€‚åŸºç›¤ã¨ãªã‚‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã¨ãƒ­ãƒ¼ã‚«ãƒ«å†ç”Ÿæ©Ÿèƒ½ã¯å®Ÿè£…æ¸ˆã¿ã§ã™ãŒã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®æ¤œçŸ¥ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å°‚ç”¨ UIã€åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã©ã€å®Œå…¨ãªã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä½“é¨“ã‚’æä¾›ã™ã‚‹ãŸã‚ã®é‡è¦ãªæ©Ÿèƒ½ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚

### å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã®å®šç¾©

æœ¬è¨ˆç”»ã«ãŠã‘ã‚‹ã€Œå®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã€ã¨ã¯ã€ä»¥ä¸‹ã®çŠ¶æ…‹ã‚’æŒ‡ã—ã¾ã™ï¼š

1. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éä¾å­˜å‹•ä½œ**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã§ã‚‚ã‚¢ãƒ—ãƒªã®ä¸»è¦æ©Ÿèƒ½ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ›²ã®å†ç”Ÿã€ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆç®¡ç†ï¼‰ãŒå®Œå…¨ã«å‹•ä½œã™ã‚‹
2. **é€æ˜ãªã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åˆ‡æ›¿**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®å¤‰åŒ–ã‚’è‡ªå‹•æ¤œçŸ¥ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©åˆ‡ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã™ã‚‹
3. **ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æ“ä½œã‚’è¨˜éŒ²ã—ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«è‡ªå‹•åŒæœŸã™ã‚‹
4. **å„ªã‚ŒãŸ UX**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã§ã‚‚ç›´æ„Ÿçš„ã§å¿«é©ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›ã™ã‚‹
5. **å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã«å‡¦ç†ã—ã€ã‚¢ãƒ—ãƒªã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’é˜²ã

### æœŸå¾…ã•ã‚Œã‚‹æˆæœ

- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½å®Œæˆåº¦**: 57% â†’ **100%**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦å‘ä¸Š**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã§ã‚‚ä¸­æ–­ã®ãªã„éŸ³æ¥½ä½“é¨“
- **ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡ä½æ¸›**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’**95%å‰Šæ¸›**
- **ãƒ‡ãƒ¼ã‚¿æ¶ˆè²»æœ€é©åŒ–**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã«ã‚ˆã‚Šä¸è¦ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’**60%å‰Šæ¸›**
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨å®¹é‡ã‚’æŠŠæ¡ã—ã€åŠ¹ç‡çš„ã«ç®¡ç†ã§ãã‚‹

---

## ç¾çŠ¶åˆ†æ

### æ—¢å­˜æ©Ÿèƒ½ã®è©³ç´°

#### âœ… ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ï¼ˆå®Œæˆåº¦ 95%ï¼‰

**å®Ÿè£…æ¸ˆã¿:**

- [`services/OfflineStorageService.ts`](services/OfflineStorageService.ts): æ›²ã¨ã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å‰Šé™¤ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹ã€‚
- [`components/DownloadButton.tsx`](components/DownloadButton.tsx): ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ UIã€‚
- `hooks/useDownloadStatus.ts`, `hooks/useDownloadedSongs.ts`: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã¨æ›²ãƒªã‚¹ãƒˆã‚’ç®¡ç†ã™ã‚‹ãƒ•ãƒƒã‚¯ã€‚

**ä¸è¶³ç‚¹:**

- ãƒãƒƒãƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é€²æ—ã®è©³ç´°è¡¨ç¤ºã€Wi-Fi å°‚ç”¨è¨­å®šã€å¤±æ•—æ™‚ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã€‚

#### âœ… ãƒ­ãƒ¼ã‚«ãƒ«å†ç”Ÿï¼ˆå®Œæˆåº¦ 100%ï¼‰

**å®Ÿè£…æ¸ˆã¿:**

- `react-native-track-player` ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è‡ªå‹•çš„ã«æ¤œçŸ¥ã—ã¦å†ç”Ÿã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ (`hooks/TrackPlayer/utils.ts`) ã‚’å®Ÿè£…æ¸ˆã¿ã€‚
- æ›²ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ¸¡ã™éš›ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®éŸ³æºãƒ‘ã‚¹ãŒå­˜åœ¨ã™ã‚Œã°ãƒªãƒ¢ãƒ¼ãƒˆ URL ã‚ˆã‚Šå„ªå…ˆã—ã¦ä½¿ç”¨ã™ã‚‹ã€‚

#### âœ… MMKV ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆå®Œæˆåº¦ 90%ï¼‰

**å®Ÿè£…æ¸ˆã¿:**

- é«˜é€Ÿãª Key-Value ã‚¹ãƒˆã‚¢ã§ã‚ã‚‹ MMKV ã‚’ã€ã‚¢ãƒ—ãƒªå…¨ä½“ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚„ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ç”¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦å°å…¥æ¸ˆã¿ã€‚
- React Query ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ°¸ç¶šåŒ–ç”¨ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã€‚

**ä¸è¶³ç‚¹:**

- èªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ°¸ç¶šåŒ–ã«ã€ä¸€éƒ¨`AsyncStorage`ãŒæ®‹ã£ã¦ã„ã‚‹ã€‚

#### âœ… React Query æ°¸ç¶šåŒ–ï¼ˆå®Œæˆåº¦ 100%ï¼‰

**å®Ÿè£…æ¸ˆã¿:**

- `PersistQueryClientProvider`ã«ã‚ˆã‚Šã€React Query ã§å–å¾—ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯ MMKV ã« 24 æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã€‚
- ã“ã‚Œã«ã‚ˆã‚Šã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã§ã‚‚ä»¥å‰èª­ã¿è¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºå¯èƒ½ã€‚

#### âš ï¸ èªè¨¼æ°¸ç¶šåŒ–ï¼ˆéƒ¨åˆ†å®Ÿè£…ï¼‰

**ç¾çŠ¶:**

- Supabase ã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã¯`AsyncStorage`ã‚’ä½¿ç”¨ã—ã¦æ°¸ç¶šåŒ–ã•ã‚Œã¦ã„ã‚‹ã€‚å®Œå…¨ãªã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã€MMKV ã¸ã®ç§»è¡ŒãŒæœ›ã¾ã—ã„ã€‚

### å¼·ã¿ã¨å¼±ã¿

#### å¼·ã¿ ğŸ’ª

1. **å …ç‰¢ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŸºç›¤**: MMKV ã«ã‚ˆã‚‹é«˜é€Ÿãƒ»é«˜ä¿¡é ¼æ€§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
2. **å®Œå…¨ãªãƒ­ãƒ¼ã‚«ãƒ«å†ç”Ÿ**: TrackPlayer ã®çµ±åˆãŒå®Œç’§
3. **åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 58 ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ TDD å®Ÿè·µ
4. **ã‚¯ãƒªãƒ¼ãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã€hooks å±¤ã®æ˜ç¢ºãªåˆ†é›¢

#### å¼±ã¿ ğŸš§

1. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®ç„¡è¦–**: NetInfo ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã ãŒæœªä½¿ç”¨
2. **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ UI ã®æ¬ å¦‚**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ›²å°‚ç”¨ã®ç”»é¢ãŒãªã„
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¸è¶³**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒä¸å®Œå…¨
4. **åŒæœŸæ©Ÿèƒ½ãªã—**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ“ä½œã®è¨˜éŒ²ãƒ»åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒå­˜åœ¨ã—ãªã„
5. **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç† UI ä¸è¶³**: ä½¿ç”¨å®¹é‡ã®å¯è¦–åŒ–ã‚„è‡ªå‹•å‰Šé™¤æ©Ÿèƒ½ãŒãªã„

### æŠ€è¡“çš„è² å‚µ

1. **AsyncStorage ä¾å­˜**: èªè¨¼å‘¨ã‚Šã§ AsyncStorage ãŒæ®‹å­˜
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€æ€§æ¬ å¦‚**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å€‹åˆ¥å¯¾å¿œ
3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æœªæŠ½è±¡åŒ–**: Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç›´æ¥ä½¿ç”¨
4. **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ“ä½œã®ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°æœªå®Ÿè£…**: ã€Œã„ã„ã­ã€ã‚„ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆç·¨é›†ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã«å¤±ã‚ã‚Œã‚‹

---

## å®Ÿè£…è¨ˆç”»

### ãƒ•ã‚§ãƒ¼ã‚º 1: åŸºç›¤æ•´å‚™ï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰âš¡

#### 1.1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹æ¤œçŸ¥ã®å®Ÿè£…

**ç›®çš„**: ã‚¢ãƒ—ãƒªãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã‚’å¸¸ã«æŠŠæ¡ã—ã€é©åˆ‡ã«å‹•ä½œã™ã‚‹

**å®Ÿè£…å†…å®¹:**

##### A. NetInfo çµ±åˆ

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `hooks/useNetworkStatus.ts`

```typescript
import NetInfo from "@react-native-community/netinfo";
import { useEffect, useState } from "react";
import { onlineManager } from "@tanstack/react-query";

export interface NetworkStatus {
  isConnected: boolean;
  isInternetReachable: boolean | null;
  type: string;
}

export function useNetworkStatus() {
  const [networkStatus, setNetworkStatus] = useState<NetworkStatus>({
    isConnected: false,
    isInternetReachable: null,
    type: "unknown",
  });

  useEffect(() => {
    // åˆæœŸçŠ¶æ…‹ã‚’å–å¾—
    NetInfo.fetch().then((state) => {
      const status = {
        isConnected: state.isConnected ?? false,
        isInternetReachable: state.isInternetReachable,
        type: state.type,
      };
      setNetworkStatus(status);

      // React Queryã®onlineManagerã¨åŒæœŸ
      onlineManager.setOnline(state.isConnected ?? false);
    });

    // çŠ¶æ…‹å¤‰åŒ–ã‚’ç›£è¦–
    const unsubscribe = NetInfo.addEventListener((state) => {
      const status = {
        isConnected: state.isConnected ?? false,
        isInternetReachable: state.isInternetReachable,
        type: state.type,
      };
      setNetworkStatus(status);
      onlineManager.setOnline(state.isConnected ?? false);
    });

    return () => unsubscribe();
  }, []);

  return networkStatus;
}
```

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `__tests__/hooks/useNetworkStatus.test.ts`

```typescript
import { renderHook, waitFor } from "@testing-library/react-native";
import NetInfo from "@react-native-community/netinfo";
import { useNetworkStatus } from "@/hooks/useNetworkStatus";

jest.mock("@react-native-community/netinfo");

describe("useNetworkStatus", () => {
  it("åˆæœŸçŠ¶æ…‹ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹", async () => {
    const mockState = {
      isConnected: true,
      isInternetReachable: true,
      type: "wifi",
    };

    (NetInfo.fetch as jest.Mock).mockResolvedValue(mockState);

    const { result } = renderHook(() => useNetworkStatus());

    await waitFor(() => {
      expect(result.current.isConnected).toBe(true);
    });
  });

  it("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®å¤‰åŒ–ã‚’æ¤œçŸ¥ã™ã‚‹", async () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…...
  });
});
```

##### B. React Query ã® onlineManager çµ±åˆ

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**: [`app/_layout.tsx`](app/_layout.tsx)

```typescript
// onlineManager ã®åˆæœŸåŒ–ã‚’è¿½åŠ 
import { onlineManager } from "@tanstack/react-query";
import NetInfo from "@react-native-community/netinfo";

// RootLayoutã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…
useEffect(() => {
  // React Queryã®onlineManagerã‚’NetInfoã¨é€£æº
  onlineManager.setEventListener((setOnline) => {
    return NetInfo.addEventListener((state) => {
      setOnline(state.isConnected ?? false);
    });
  });
}, []);
```

##### C. ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `providers/NetworkProvider.tsx`

```typescript
import React, { createContext, useContext, ReactNode } from "react";
import { useNetworkStatus, NetworkStatus } from "@/hooks/useNetworkStatus";

interface NetworkContextValue {
  networkStatus: NetworkStatus;
}

const NetworkContext = createContext<NetworkContextValue | undefined>(
  undefined
);

export function NetworkProvider({ children }: { children: ReactNode }) {
  const networkStatus = useNetworkStatus();

  return (
    <NetworkContext.Provider value={{ networkStatus }}>
      {children}
    </NetworkContext.Provider>
  );
}

export function useNetwork() {
  const context = useContext(NetworkContext);
  if (!context) {
    throw new Error("useNetwork must be used within NetworkProvider");
  }
  return context;
}
```

**çµ±åˆ**: [`app/_layout.tsx`](app/_layout.tsx)ã« NetworkProvider ã‚’è¿½åŠ 

#### 1.2 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ UI

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `components/common/OfflineIndicator.tsx`

```typescript
import React from "react";
import { View, Text, StyleSheet } from "react-native";
import { Ionicons } from "@expo/vector-icons";
import { useNetwork } from "@/providers/NetworkProvider";
import Animated, { FadeInDown, FadeOutUp } from "react-native-reanimated";

export function OfflineIndicator() {
  const { networkStatus } = useNetwork();

  if (networkStatus.isConnected) {
    return null;
  }

  return (
    <Animated.View
      entering={FadeInDown}
      exiting={FadeOutUp}
      style={styles.container}
    >
      <Ionicons name="cloud-offline" size={16} color="#fff" />
      <Text style={styles.text}>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰</Text>
    </Animated.View>
  );
}

const styles = StyleSheet.create({
  container: {
    backgroundColor: "#f59e0b",
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: 8,
    gap: 8,
  },
  text: {
    color: "#fff",
    fontSize: 14,
    fontWeight: "600",
  },
});
```

**é…ç½®**: ã™ã¹ã¦ã®ç”»é¢ã®ãƒ˜ãƒƒãƒ€ãƒ¼ä¸‹ã«è¡¨ç¤ºï¼ˆ[`app/_layout.tsx`](app/_layout.tsx)ã® Stack ã«è¿½åŠ ï¼‰

#### 1.3 åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

##### A. Supabase ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ©ãƒƒãƒ‘ãƒ¼

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/supabase-wrapper.ts`

```typescript
import { supabase } from "./supabase";
import { PostgrestError } from "@supabase/supabase-js";

export interface RequestResult<T> {
  data: T | null;
  error: PostgrestError | Error | null;
  isOffline: boolean;
}

/**
 * Supabaseãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ©ãƒƒãƒ—ã—ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æä¾›
 */
export async function safeSupabaseRequest<T>(
  request: () => Promise<{ data: T | null; error: PostgrestError | null }>
): Promise<RequestResult<T>> {
  try {
    const result = await request();
    return {
      data: result.data,
      error: result.error,
      isOffline: false,
    };
  } catch (error) {
    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®æ¤œå‡º
    if (
      error instanceof Error &&
      (error.message.includes("Network request failed") ||
        error.message.includes("Failed to fetch"))
    ) {
      console.log("ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’æ¤œå‡º:", error.message);
      return {
        data: null,
        error: new Error("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“"),
        isOffline: true,
      };
    }

    return {
      data: null,
      error: error instanceof Error ? error : new Error(String(error)),
      isOffline: false,
    };
  }
}
```

**ä½¿ç”¨ä¾‹**: [`actions/getSongs.ts`](actions/getSongs.ts)ã®æ”¹ä¿®

```typescript
import { safeSupabaseRequest } from "@/lib/supabase-wrapper";

export default async function getSongs(): Promise<Song[]> {
  const result = await safeSupabaseRequest(async () => {
    return supabase
      .from("songs")
      .select("*")
      .order("created_at", { ascending: false });
  });

  if (result.isOffline) {
    // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ï¼ˆReact QueryãŒè‡ªå‹•å‡¦ç†ï¼‰
    throw new Error("OFFLINE");
  }

  if (result.error) {
    throw result.error;
  }

  return result.data || [];
}
```

##### B. ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªå®Ÿè£…

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `components/common/ErrorBoundary.tsx`

```typescript
import React, { Component, ReactNode } from "react";
import { View, Text, StyleSheet, TouchableOpacity } from "react-native";
import { Ionicons } from "@expo/vector-icons";

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error("ErrorBoundary caught error:", error, errorInfo);
  }

  handleReset = () => {
    this.setState({ hasError: false, error: null });
  };

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return (
        <View style={styles.container}>
          <Ionicons name="alert-circle" size={64} color="#ef4444" />
          <Text style={styles.title}>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</Text>
          <Text style={styles.message}>
            {this.state.error?.message || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}
          </Text>
          <TouchableOpacity style={styles.button} onPress={this.handleReset}>
            <Text style={styles.buttonText}>å†è©¦è¡Œ</Text>
          </TouchableOpacity>
        </View>
      );
    }

    return this.props.children;
  }
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    backgroundColor: "#000",
    padding: 24,
    gap: 16,
  },
  title: {
    color: "#fff",
    fontSize: 24,
    fontWeight: "bold",
  },
  message: {
    color: "#999",
    fontSize: 16,
    textAlign: "center",
  },
  button: {
    backgroundColor: "#4c1d95",
    paddingVertical: 12,
    paddingHorizontal: 32,
    borderRadius: 8,
    marginTop: 16,
  },
  buttonText: {
    color: "#fff",
    fontSize: 16,
    fontWeight: "600",
  },
});
```

**çµ±åˆ**: [`app/_layout.tsx`](app/_layout.tsx)ã§ã‚¢ãƒ—ãƒªå…¨ä½“ã‚’ãƒ©ãƒƒãƒ—

##### C. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `constants/error-messages.ts`

```typescript
export const ERROR_MESSAGES = {
  NETWORK_ERROR:
    "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§åˆ©ç”¨ã§ãã‚‹æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚",
  DOWNLOAD_FAILED:
    "æ›²ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
  LOAD_FAILED:
    "ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",
  AUTH_REQUIRED: "ã“ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚",
  STORAGE_FULL: "ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ä¸è¦ãªæ›²ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚",
} as const;

export function getErrorMessage(error: unknown): string {
  if (error instanceof Error) {
    if (error.message === "OFFLINE") {
      return ERROR_MESSAGES.NETWORK_ERROR;
    }
    return error.message;
  }
  return "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
}
```

**ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ 1 å®Œäº†æ¡ä»¶:**

- [ ] NetInfo ãŒçµ±åˆã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ãŒæ­£ç¢ºã«æ¤œçŸ¥ã•ã‚Œã‚‹
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãŒå…¨ç”»é¢ã§æ©Ÿèƒ½ã™ã‚‹
- [ ] Supabase ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã™ã¹ã¦ãƒ©ãƒƒãƒ—ã•ã‚Œã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã«ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã«å¤±æ•—ã™ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªãŒã‚¢ãƒ—ãƒªã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’é˜²ã
- [ ] ã™ã¹ã¦ã®æ–°æ©Ÿèƒ½ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã‚‹ï¼ˆTDD æº–æ‹ ï¼‰

---

### ãƒ•ã‚§ãƒ¼ã‚º 2: UI/UX å¼·åŒ–ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰ğŸ¨

#### 2.1 Library ã«ã€ŒDownloadsã€ã‚¿ãƒ–è¿½åŠ 

**ç›®çš„**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ›²ã‚’ä¸€å…ƒç®¡ç†ã§ãã‚‹å°‚ç”¨ç”»é¢ã‚’æä¾›

##### A. LibraryDownloads ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¨­è¨ˆ

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `screens/LibraryDownloads.tsx`

```typescript
import React, { useState, useCallback, useMemo } from "react";
import { View, Text, StyleSheet, TouchableOpacity } from "react-native";
import { FlashList } from "@shopify/flash-list";
import { useDownloadedSongs } from "@/hooks/useDownloadedSongs";
import { useAudioPlayer } from "@/hooks/useAudioPlayer";
import SongItem from "@/components/item/SongItem";
import Loading from "@/components/common/Loading";
import Error from "@/components/common/Error";
import { Ionicons } from "@expo/vector-icons";

type SortOption = "title" | "author" | "downloadDate";
type SortOrder = "asc" | "desc";

export default function LibraryDownloads() {
  const { songs, isLoading, error, refresh } = useDownloadedSongs();
  const [sortBy, setSortBy] = useState<SortOption>("downloadDate");
  const [sortOrder, setSortOrder] = useState<SortOrder>("desc");
  const [filterQuery, setFilterQuery] = useState("");

  // ã‚½ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  const processedSongs = useMemo(() => {
    let result = [...songs];

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    if (filterQuery) {
      result = result.filter(
        (song) =>
          song.title.toLowerCase().includes(filterQuery.toLowerCase()) ||
          song.author.toLowerCase().includes(filterQuery.toLowerCase())
      );
    }

    // ã‚½ãƒ¼ãƒˆ
    result.sort((a, b) => {
      let comparison = 0;

      switch (sortBy) {
        case "title":
          comparison = a.title.localeCompare(b.title);
          break;
        case "author":
          comparison = a.author.localeCompare(b.author);
          break;
        case "downloadDate":
          // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—ï¼ˆå®Ÿè£…æ™‚ã«è©³ç´°åŒ–ï¼‰
          comparison = 0;
          break;
      }

      return sortOrder === "asc" ? comparison : -comparison;
    });

    return result;
  }, [songs, sortBy, sortOrder, filterQuery]);

  const { togglePlayPause } = useAudioPlayer(processedSongs, "downloads");

  const renderItem = useCallback(
    ({ item }) => (
      <SongItem song={item} onClick={() => togglePlayPause(item)} dynamicSize />
    ),
    [togglePlayPause]
  );

  if (isLoading) return <Loading />;
  if (error) return <Error message={error} />;

  return (
    <View style={styles.container}>
      <View style={styles.header}>
        <Text style={styles.title}>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿</Text>
        <Text style={styles.subtitle}>{songs.length}æ›²</Text>
      </View>

      {/* ã‚½ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼UI */}
      <View style={styles.controls}>{/* å®Ÿè£…è©³ç´° */}</View>

      {processedSongs.length > 0 ? (
        <FlashList
          data={processedSongs}
          renderItem={renderItem}
          keyExtractor={(item) => item.id}
          numColumns={2}
          estimatedItemSize={200}
        />
      ) : (
        <View style={styles.empty}>
          <Ionicons name="cloud-download-outline" size={64} color="#666" />
          <Text style={styles.emptyText}>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã®æ›²ãŒã‚ã‚Šã¾ã›ã‚“</Text>
        </View>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#000",
  },
  header: {
    padding: 16,
    borderBottomWidth: 1,
    borderBottomColor: "#333",
  },
  title: {
    color: "#fff",
    fontSize: 28,
    fontWeight: "bold",
  },
  subtitle: {
    color: "#999",
    fontSize: 14,
    marginTop: 4,
  },
  controls: {
    padding: 16,
    gap: 12,
  },
  empty: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    gap: 16,
  },
  emptyText: {
    color: "#666",
    fontSize: 16,
  },
});
```

##### B. Library ã‚¿ãƒ–ã¸ã®çµ±åˆ

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**: [`app/(tabs)/library.tsx`](<app/(tabs)/library.tsx>)

```typescript
// ã‚¿ã‚¤ãƒ—ã« 'downloads' ã‚’è¿½åŠ 
type LibraryType = "liked" | "playlists" | "downloads";

// ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
<CustomButton
  label="Downloads"
  isActive={type === "downloads"}
  onPress={() => setType("downloads")}
/>;

// ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åˆ†å²
{
  type === "downloads" && <LibraryDownloads />;
}
```

##### C. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çµ±è¨ˆæƒ…å ±

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `hooks/useDownloadStats.ts`

```typescript
import { useQuery } from "@tanstack/react-query";
import { getOfflineStorageService } from "./TrackPlayer/utils";
import * as FileSystem from "expo-file-system";

export interface DownloadStats {
  totalSongs: number;
  totalSize: number; // ãƒã‚¤ãƒˆ
  totalSizeFormatted: string; // "123.4 MB"
  averageSongSize: number;
}

export function useDownloadStats() {
  return useQuery({
    queryKey: ["downloadStats"],
    queryFn: async (): Promise<DownloadStats> => {
      const offlineService = getOfflineStorageService();
      const songs = await offlineService.getDownloadedSongs();

      let totalSize = 0;

      for (const song of songs) {
        const fileInfo = await FileSystem.getInfoAsync(song.song_path);
        if (fileInfo.exists && "size" in fileInfo) {
          totalSize += fileInfo.size;
        }
      }

      return {
        totalSongs: songs.length,
        totalSize,
        totalSizeFormatted: formatBytes(totalSize),
        averageSongSize: songs.length > 0 ? totalSize / songs.length : 0,
      };
    },
    staleTime: 1000 * 60, // 1åˆ†
  });
}

function formatBytes(bytes: number): string {
  if (bytes === 0) return "0 B";
  const k = 1024;
  const sizes = ["B", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return `${(bytes / Math.pow(k, i)).toFixed(1)} ${sizes[i]}`;
}
```

#### 2.2 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†ç”»é¢

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `screens/StorageManagement.tsx`

```typescript
import React from "react";
import { View, Text, StyleSheet, TouchableOpacity, Alert } from "react-native";
import { useDownloadStats } from "@/hooks/useDownloadStats";
import { getOfflineStorageService } from "@/hooks/TrackPlayer/utils";
import { useQueryClient } from "@tanstack/react-query";
import Loading from "@/components/common/Loading";
import { Ionicons } from "@expo/vector-icons";

export default function StorageManagement() {
  const { data: stats, isLoading } = useDownloadStats();
  const queryClient = useQueryClient();

  const handleClearAll = () => {
    Alert.alert("ã™ã¹ã¦å‰Šé™¤", "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã®ã™ã¹ã¦ã®æ›²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ", [
      { text: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", style: "cancel" },
      {
        text: "å‰Šé™¤",
        style: "destructive",
        onPress: async () => {
          const service = getOfflineStorageService();
          await service.clearAllDownloads();
          queryClient.invalidateQueries({ queryKey: ["downloadedSongs"] });
          queryClient.invalidateQueries({ queryKey: ["downloadStats"] });
        },
      },
    ]);
  };

  if (isLoading) return <Loading />;

  return (
    <View style={styles.container}>
      <Text style={styles.title}>ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†</Text>

      <View style={styles.statsCard}>
        <View style={styles.statRow}>
          <Ionicons name="musical-notes" size={24} color="#fff" />
          <Text style={styles.statLabel}>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ›²æ•°</Text>
          <Text style={styles.statValue}>{stats?.totalSongs || 0}</Text>
        </View>

        <View style={styles.statRow}>
          <Ionicons name="save" size={24} color="#fff" />
          <Text style={styles.statLabel}>ä½¿ç”¨å®¹é‡</Text>
          <Text style={styles.statValue}>
            {stats?.totalSizeFormatted || "0 B"}
          </Text>
        </View>

        <View style={styles.statRow}>
          <Ionicons name="stats-chart" size={24} color="#fff" />
          <Text style={styles.statLabel}>å¹³å‡æ›²ã‚µã‚¤ã‚º</Text>
          <Text style={styles.statValue}>
            {formatBytes(stats?.averageSongSize || 0)}
          </Text>
        </View>
      </View>

      <View style={styles.section}>
        <Text style={styles.sectionTitle}>è¨­å®š</Text>

        {/* ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰è¨­å®š */}
        <View style={styles.settingItem}>
          <Text style={styles.settingLabel}>Wi-Fiæ¥ç¶šæ™‚ã®ã¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</Text>
          {/* Switch ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */}
        </View>

        <View style={styles.settingItem}>
          <Text style={styles.settingLabel}>éŸ³è³ª</Text>
          <Text style={styles.settingValue}>é«˜å“è³ªï¼ˆ320kbpsï¼‰</Text>
        </View>
      </View>

      <TouchableOpacity style={styles.dangerButton} onPress={handleClearAll}>
        <Ionicons name="trash" size={20} color="#fff" />
        <Text style={styles.dangerButtonText}>ã™ã¹ã¦å‰Šé™¤</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#000",
    padding: 16,
  },
  title: {
    color: "#fff",
    fontSize: 28,
    fontWeight: "bold",
    marginBottom: 24,
  },
  statsCard: {
    backgroundColor: "#1a1a1a",
    borderRadius: 12,
    padding: 16,
    gap: 16,
    marginBottom: 24,
  },
  statRow: {
    flexDirection: "row",
    alignItems: "center",
    gap: 12,
  },
  statLabel: {
    flex: 1,
    color: "#999",
    fontSize: 16,
  },
  statValue: {
    color: "#fff",
    fontSize: 18,
    fontWeight: "600",
  },
  section: {
    marginBottom: 24,
  },
  sectionTitle: {
    color: "#fff",
    fontSize: 20,
    fontWeight: "bold",
    marginBottom: 16,
  },
  settingItem: {
    flexDirection: "row",
    justifyContent: "space-between",
    alignItems: "center",
    paddingVertical: 12,
    borderBottomWidth: 1,
    borderBottomColor: "#333",
  },
  settingLabel: {
    color: "#fff",
    fontSize: 16,
  },
  settingValue: {
    color: "#999",
    fontSize: 14,
  },
  dangerButton: {
    backgroundColor: "#ef4444",
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "center",
    padding: 16,
    borderRadius: 8,
    gap: 8,
  },
  dangerButtonText: {
    color: "#fff",
    fontSize: 16,
    fontWeight: "600",
  },
});

function formatBytes(bytes: number): string {
  // å‰è¿°ã®å®Ÿè£…ã¨åŒã˜
}
```

**ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ**: è¨­å®šç”»é¢ã‚„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”»é¢ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹

**ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ 2 å®Œäº†æ¡ä»¶:**

- [ ] Library ã« Downloads ã‚¿ãƒ–ãŒè¿½åŠ ã•ã‚Œã‚‹
- [ ] ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ›²ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [ ] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†ç”»é¢ã§ä½¿ç”¨å®¹é‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [ ] ã™ã¹ã¦ã® UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒ†ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã‚‹

---

### ãƒ•ã‚§ãƒ¼ã‚º 3: é«˜åº¦ãªæ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ã€œä½ï¼‰ğŸš€

#### 3.1 ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

**ç›®çš„**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æ“ä½œã‚’è¨˜éŒ²ã—ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«è‡ªå‹•åŒæœŸ

##### A. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ“ä½œã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `services/OfflineQueueService.ts`

```typescript
import { MMKV } from "react-native-mmkv";

export type QueuedOperation = {
  id: string;
  type:
    | "LIKE_SONG"
    | "UNLIKE_SONG"
    | "CREATE_PLAYLIST"
    | "UPDATE_PLAYLIST"
    | "DELETE_PLAYLIST";
  payload: any;
  timestamp: number;
  retryCount: number;
};

export class OfflineQueueService {
  private storage: MMKV;
  private readonly QUEUE_KEY = "offline-operation-queue";

  constructor() {
    this.storage = new MMKV({ id: "offline-queue" });
  }

  /**
   * ã‚­ãƒ¥ãƒ¼ã«æ“ä½œã‚’è¿½åŠ 
   */
  async enqueue(
    operation: Omit<QueuedOperation, "id" | "timestamp" | "retryCount">
  ) {
    const queuedOp: QueuedOperation = {
      ...operation,
      id: `${Date.now()}-${Math.random()}`,
      timestamp: Date.now(),
      retryCount: 0,
    };

    const queue = this.getQueue();
    queue.push(queuedOp);
    this.saveQueue(queue);

    return queuedOp.id;
  }

  /**
   * ã‚­ãƒ¥ãƒ¼ã‹ã‚‰æ“ä½œã‚’å–å¾—
   */
  getQueue(): QueuedOperation[] {
    const queueStr = this.storage.getString(this.QUEUE_KEY);
    return queueStr ? JSON.parse(queueStr) : [];
  }

  /**
   * ã‚­ãƒ¥ãƒ¼ã‚’ä¿å­˜
   */
  private saveQueue(queue: QueuedOperation[]) {
    this.storage.set(this.QUEUE_KEY, JSON.stringify(queue));
  }

  /**
   * ç‰¹å®šã®æ“ä½œã‚’å‰Šé™¤
   */
  async dequeue(operationId: string) {
    const queue = this.getQueue().filter((op) => op.id !== operationId);
    this.saveQueue(queue);
  }

  /**
   * ã™ã¹ã¦ã®æ“ä½œã‚’å‡¦ç†
   */
  async processQueue() {
    const queue = this.getQueue();
    const results = [];

    for (const operation of queue) {
      try {
        await this.executeOperation(operation);
        await this.dequeue(operation.id);
        results.push({ id: operation.id, success: true });
      } catch (error) {
        console.error("Failed to process operation:", operation, error);

        // ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—ã‚„ã™
        operation.retryCount++;

        if (operation.retryCount >= 3) {
          // 3å›å¤±æ•—ã—ãŸã‚‰å‰Šé™¤
          await this.dequeue(operation.id);
          results.push({
            id: operation.id,
            success: false,
            error: "Max retries exceeded",
          });
        } else {
          // å†ä¿å­˜
          this.saveQueue(queue);
          results.push({
            id: operation.id,
            success: false,
            error: String(error),
          });
        }
      }
    }

    return results;
  }

  /**
   * æ“ä½œã‚’å®Ÿè¡Œ
   */
  private async executeOperation(operation: QueuedOperation) {
    switch (operation.type) {
      case "LIKE_SONG":
        // toggleLikeSong ã®å®Ÿè£…ã‚’å‘¼ã¶
        break;
      case "CREATE_PLAYLIST":
        // createPlaylist ã®å®Ÿè£…ã‚’å‘¼ã¶
        break;
      // ãã®ä»–ã®æ“ä½œ...
    }
  }

  /**
   * ã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢
   */
  async clearQueue() {
    this.storage.delete(this.QUEUE_KEY);
  }
}
```

##### B. è‡ªå‹•åŒæœŸãƒˆãƒªã‚¬ãƒ¼

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `hooks/useOfflineSync.ts`

```typescript
import { useEffect } from "react";
import { useNetwork } from "@/providers/NetworkProvider";
import { OfflineQueueService } from "@/services/OfflineQueueService";
import { useQueryClient } from "@tanstack/react-query";

const queueService = new OfflineQueueService();

export function useOfflineSync() {
  const { networkStatus } = useNetwork();
  const queryClient = useQueryClient();

  useEffect(() => {
    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ãªã£ãŸã‚‰åŒæœŸ
    if (networkStatus.isConnected) {
      const syncQueue = async () => {
        console.log("Syncing offline operations...");
        const results = await queueService.processQueue();

        // æˆåŠŸã—ãŸæ“ä½œã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–
        if (results.some((r) => r.success)) {
          queryClient.invalidateQueries();
        }

        console.log("Sync completed:", results);
      };

      syncQueue();
    }
  }, [networkStatus.isConnected, queryClient]);
}
```

**çµ±åˆ**: [`app/_layout.tsx`](app/_layout.tsx)ã§ useOfflineSync ã‚’å‘¼ã¶

##### C. ç«¶åˆè§£æ±ºæˆ¦ç•¥

**è¨­è¨ˆæ–¹é‡:**

1. **Last-Write-Wins**: æœ€å¾Œã®æ“ä½œã‚’å„ªå…ˆï¼ˆãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåå¤‰æ›´ãªã©ï¼‰
2. **Merge**: ä¸¡æ–¹ã‚’ä¿æŒï¼ˆãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè¿½åŠ ãªã©ï¼‰
3. **User-Prompt**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¸æŠã•ã›ã‚‹ï¼ˆé‡è¦ãªç«¶åˆæ™‚ï¼‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `services/ConflictResolver.ts`

```typescript
export class ConflictResolver {
  /**
   * ç«¶åˆã‚’æ¤œå‡ºã—ã¦è§£æ±º
   */
  async resolveConflict(
    localOperation: QueuedOperation,
    serverData: any
  ): Promise<{
    resolved: boolean;
    action: "keep-local" | "keep-server" | "merge";
  }> {
    // å®Ÿè£…è©³ç´°
    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ¯”è¼ƒã€ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ãªã©
  }
}
```

#### 3.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

##### A. AsyncStorageâ†’MMKV å®Œå…¨ç§»è¡Œ

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: èªè¨¼é–¢é€£ï¼ˆSupabase è¨­å®šï¼‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/supabase.ts`ï¼ˆå¤‰æ›´ï¼‰

```typescript
import { createClient } from "@supabase/supabase-js";
import { storage } from "./mmkv-storage";

// MMKVã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’ä½œæˆ
const mmkvAdapter = {
  getItem: (key: string) => {
    const value = storage.getString(key);
    return value ?? null;
  },
  setItem: (key: string, value: string) => {
    storage.set(key, value);
  },
  removeItem: (key: string) => {
    storage.delete(key);
  },
};

export const supabase = createClient(
  process.env.EXPO_PUBLIC_SUPABASE_URL!,
  process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY!,
  {
    auth: {
      storage: mmkvAdapter, // AsyncStorageã‹ã‚‰MMKVã¸
      autoRefreshToken: true,
      persistSession: true,
      detectSessionInUrl: false,
    },
  }
);
```

##### B. ç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–

**expo-image ã®è¨­å®šæœ€é©åŒ–**

```typescript
// app/_layout.tsx ã«è¿½åŠ 
import { Image } from "expo-image";

// ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å®Ÿè¡Œ
Image.clearDiskCache();
Image.clearMemoryCache();

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒªã‚·ãƒ¼è¨­å®š
const cachePolicy = {
  disk: "force-cache",
  memory: "default",
};
```

##### C. ãƒãƒƒãƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `hooks/useBatchDownload.ts`

```typescript
import { useState } from "react";
import { getOfflineStorageService } from "./TrackPlayer/utils";
import Song from "@/types";

export function useBatchDownload() {
  const [progress, setProgress] = useState<{
    total: number;
    completed: number;
    failed: number;
    current: string | null;
  }>({
    total: 0,
    completed: 0,
    failed: 0,
    current: null,
  });

  const downloadBatch = async (songs: Song[]) => {
    const service = getOfflineStorageService();

    setProgress({
      total: songs.length,
      completed: 0,
      failed: 0,
      current: null,
    });

    for (let i = 0; i < songs.length; i++) {
      const song = songs[i];

      setProgress((prev) => ({
        ...prev,
        current: song.title,
      }));

      try {
        await service.downloadSong(song);
        setProgress((prev) => ({
          ...prev,
          completed: prev.completed + 1,
        }));
      } catch (error) {
        console.error(`Failed to download ${song.title}:`, error);
        setProgress((prev) => ({
          ...prev,
          failed: prev.failed + 1,
        }));
      }
    }

    setProgress((prev) => ({
      ...prev,
      current: null,
    }));
  };

  return { progress, downloadBatch };
}
```

**ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ 3 å®Œäº†æ¡ä»¶:**

- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ“ä½œãŒæ­£ã—ãã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã•ã‚Œã‚‹
- [ ] ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«è‡ªå‹•åŒæœŸãŒå‹•ä½œã™ã‚‹
- [ ] èªè¨¼ãŒ MMKV ã«å®Œå…¨ç§»è¡Œã•ã‚Œã‚‹
- [ ] ãƒãƒƒãƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒåŠ¹ç‡çš„ã«å‹•ä½œã™ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã§æ”¹å–„ãŒç¢ºèªã•ã‚Œã‚‹

---

## æŠ€è¡“ä»•æ§˜

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
badwave-mobile/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ OfflineStorageService.ts        # æ—¢å­˜
â”‚   â”œâ”€â”€ OfflineQueueService.ts          # æ–°è¦
â”‚   â”œâ”€â”€ ConflictResolver.ts             # æ–°è¦
â”‚   â””â”€â”€ PlayerService.ts                # æ—¢å­˜
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useNetworkStatus.ts             # æ–°è¦
â”‚   â”œâ”€â”€ useOfflineSync.ts               # æ–°è¦
â”‚   â”œâ”€â”€ useDownloadStats.ts             # æ–°è¦
â”‚   â”œâ”€â”€ useBatchDownload.ts             # æ–°è¦
â”‚   â”œâ”€â”€ useDownloadedSongs.ts           # æ—¢å­˜
â”‚   â””â”€â”€ useDownloadStatus.ts            # æ—¢å­˜
â”œâ”€â”€ providers/
â”‚   â”œâ”€â”€ NetworkProvider.tsx             # æ–°è¦
â”‚   â””â”€â”€ AuthProvider.tsx                # æ—¢å­˜
â”œâ”€â”€ components/
â”‚   â””â”€â”€ common/
â”‚       â”œâ”€â”€ OfflineIndicator.tsx        # æ–°è¦
â”‚       â”œâ”€â”€ ErrorBoundary.tsx           # æ–°è¦
â”‚       â””â”€â”€ ...
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ LibraryDownloads.tsx            # æ–°è¦
â”‚   â””â”€â”€ StorageManagement.tsx           # æ–°è¦
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase-wrapper.ts             # æ–°è¦
â”‚   â”œâ”€â”€ supabase.ts                     # å¤‰æ›´ï¼ˆMMKVçµ±åˆï¼‰
â”‚   â”œâ”€â”€ mmkv-storage.ts                 # æ—¢å­˜
â”‚   â””â”€â”€ mmkv-persister.ts               # æ—¢å­˜
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ error-messages.ts               # æ–°è¦
â””â”€â”€ __tests__/
    â”œâ”€â”€ hooks/
    â”‚   â”œâ”€â”€ useNetworkStatus.test.ts    # æ–°è¦
    â”‚   â””â”€â”€ useOfflineSync.test.ts      # æ–°è¦
    â”œâ”€â”€ services/
    â”‚   â””â”€â”€ OfflineQueueService.test.ts # æ–°è¦
    â””â”€â”€ ...
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```mermaid
graph TB
    A[ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ] --> B{ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹}
    B -->|ã‚ªãƒ³ãƒ©ã‚¤ãƒ³| C[Supabase API]
    B -->|ã‚ªãƒ•ãƒ©ã‚¤ãƒ³| D[OfflineQueueService]

    C --> E[React Query Cache]
    C --> F[MMKV Storage]

    D --> G[Operation Queue]
    G --> H{ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°}
    H -->|Yes| I[Auto Sync]
    I --> C

    E --> J[UI Update]
    F --> J

    K[ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½] --> L[OfflineStorageService]
    L --> M[FileSystem]
    L --> F

    M --> N[TrackPlayer]
    N --> O[ãƒ­ãƒ¼ã‚«ãƒ«å†ç”Ÿ]

    P[NetInfo] --> Q[NetworkProvider]
    Q --> B
    Q --> R[OfflineIndicator]
```

### API è¨­è¨ˆ

#### OfflineQueueService API

```typescript
interface OfflineQueueService {
  // æ“ä½œã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
  enqueue(operation: OperationPayload): Promise<string>;

  // ã‚­ãƒ¥ãƒ¼ã‚’å–å¾—
  getQueue(): QueuedOperation[];

  // ç‰¹å®šã®æ“ä½œã‚’å‰Šé™¤
  dequeue(operationId: string): Promise<void>;

  // ã™ã¹ã¦ã®æ“ä½œã‚’å‡¦ç†
  processQueue(): Promise<ProcessResult[]>;

  // ã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢
  clearQueue(): Promise<void>;
}
```

#### NetworkProvider API

```typescript
interface NetworkContextValue {
  networkStatus: {
    isConnected: boolean;
    isInternetReachable: boolean | null;
    type: string;
  };
}

// ä½¿ç”¨ä¾‹
const { networkStatus } = useNetwork();
if (!networkStatus.isConnected) {
  // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å‡¦ç†
}
```

### çŠ¶æ…‹ç®¡ç†æˆ¦ç•¥

#### React Query è¨­å®š

```typescript
// ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æŒ™å‹•
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¿”ã™
      networkMode: "offlineFirst",
      retry: (failureCount, error) => {
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã¯ãƒªãƒˆãƒ©ã‚¤ã—ãªã„
        if (error.message === "OFFLINE") return false;
        return failureCount < 3;
      },
    },
    mutations: {
      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯ä¸€æ™‚åœæ­¢
      networkMode: "online",
      onError: (error, variables, context) => {
        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
        if (error.message === "OFFLINE") {
          queueService.enqueue({
            type: context.operationType,
            payload: variables,
          });
        }
      },
    },
  },
});
```

#### MMKV ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æˆ¦ç•¥

```typescript
// 3ã¤ã®ç‹¬ç«‹ã—ãŸMMKVã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
const instances = {
  app: new MMKV({ id: "app-storage" }), // ä¸€èˆ¬ãƒ‡ãƒ¼ã‚¿
  offline: new MMKV({ id: "offline-storage" }), // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿
  queue: new MMKV({ id: "offline-queue" }), // æ“ä½œã‚­ãƒ¥ãƒ¼
};

// æš—å·åŒ–ãŒå¿…è¦ãªå ´åˆ
const secureStorage = new MMKV({
  id: "secure-storage",
  encryptionKey: "your-encryption-key",
});
```

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆTDD æº–æ‹ ï¼‰

#### Phase 1: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿèƒ½

```typescript
// __tests__/hooks/useNetworkStatus.test.ts
describe("useNetworkStatus", () => {
  it("should detect online state", async () => {
    // NetInfoã‚’ãƒ¢ãƒƒã‚¯
    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’è¿”ã™
    // hookã®æˆ»ã‚Šå€¤ã‚’æ¤œè¨¼
  });

  it("should detect offline state", async () => {
    // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’æ¤œè¨¼
  });

  it("should update on network change", async () => {
    // çŠ¶æ…‹å¤‰åŒ–ã‚’æ¤œè¨¼
  });

  it("should sync with React Query onlineManager", async () => {
    // onlineManagerã¨ã®é€£æºã‚’æ¤œè¨¼
  });
});
```

```typescript
// __tests__/lib/supabase-wrapper.test.ts
describe("safeSupabaseRequest", () => {
  it("should handle successful request", async () => {
    // æˆåŠŸã‚±ãƒ¼ã‚¹
  });

  it("should detect offline error", async () => {
    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ¤œå‡º
  });

  it("should handle other errors", async () => {
    // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
  });
});
```

#### Phase 2: UI/UX æ©Ÿèƒ½

```typescript
// __tests__/screens/LibraryDownloads.test.tsx
describe("LibraryDownloads", () => {
  it("should render downloaded songs", async () => {
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ›²ã®è¡¨ç¤º
  });

  it("should filter songs by title", async () => {
    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
  });

  it("should sort songs", async () => {
    // ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
  });

  it("should handle empty state", () => {
    // ç©ºçŠ¶æ…‹ã®è¡¨ç¤º
  });
});
```

```typescript
// __tests__/hooks/useDownloadStats.test.ts
describe("useDownloadStats", () => {
  it("should calculate total size", async () => {
    // åˆè¨ˆã‚µã‚¤ã‚ºè¨ˆç®—
  });

  it("should format bytes correctly", () => {
    // ãƒã‚¤ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  });

  it("should handle no downloads", async () => {
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãªã—ã‚±ãƒ¼ã‚¹
  });
});
```

#### Phase 3: åŒæœŸæ©Ÿèƒ½

```typescript
// __tests__/services/OfflineQueueService.test.ts
describe("OfflineQueueService", () => {
  it("should enqueue operation", async () => {
    // ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°
  });

  it("should process queue successfully", async () => {
    // å‡¦ç†æˆåŠŸ
  });

  it("should handle failed operations", async () => {
    // å¤±æ•—å‡¦ç†
  });

  it("should retry failed operations", async () => {
    // ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
  });

  it("should remove after max retries", async () => {
    // æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å¾Œå‰Šé™¤
  });
});
```

### çµ±åˆãƒ†ã‚¹ãƒˆ

```typescript
// __tests__/integration/offline-flow.test.tsx
describe("Offline Flow Integration", () => {
  it("should download and play song offline", async () => {
    // 1. æ›²ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    // 2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆ
    // 3. æ›²ã‚’å†ç”Ÿ
    // 4. å†ç”ŸãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  });

  it("should queue operations while offline", async () => {
    // 1. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆ
    // 2. ã„ã„ã­ã‚’æŠ¼ã™
    // 3. ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // 4. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«æˆ»ã‚‹
    // 5. è‡ªå‹•åŒæœŸã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  });

  it("should show offline indicator", async () => {
    // 1. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆ
    // 2. ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    // 3. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«æˆ»ã‚‹
    // 4. ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãŒæ¶ˆãˆã‚‹
  });
});
```

### ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä¸€è¦§

1. **åŸºæœ¬çš„ãªã‚ªãƒ•ãƒ©ã‚¤ãƒ³å†ç”Ÿ**

   - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ›²ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å†ç”Ÿã§ãã‚‹
   - ã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹

2. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ‡æ–­ä¸­ã®æ“ä½œ**

   - ã„ã„ã­ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ã‚‹ï¼ˆã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ï¼‰
   - ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆãŒã§ãã‚‹ï¼ˆã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ï¼‰
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹

3. **ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°**

   - ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã•ã‚ŒãŸæ“ä½œãŒè‡ªå‹•åŒæœŸã•ã‚Œã‚‹
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ›´æ–°ã•ã‚Œã‚‹
   - UI ãŒæœ€æ–°çŠ¶æ…‹ã«æ›´æ–°ã•ã‚Œã‚‹

4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**

   - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º
   - åŒæœŸå¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤
   - ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸è¶³æ™‚ã®è­¦å‘Š

5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   - å¤§é‡ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ›²ã§ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«å‹•ä½œ
   - åŒæœŸå‡¦ç†ãŒ UI ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„
   - ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãŒç™ºç”Ÿã—ãªã„

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

```typescript
// __tests__/performance/offline-storage.test.ts
describe("OfflineStorage Performance", () => {
  it("should handle 100 songs efficiently", async () => {
    const startTime = Date.now();

    // 100æ›²ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const songs = await offlineService.getDownloadedSongs();

    const duration = Date.now() - startTime;

    expect(duration).toBeLessThan(1000); // 1ç§’ä»¥å†…
    expect(songs.length).toBe(100);
  });

  it("should sync queue quickly", async () => {
    // ã‚­ãƒ¥ãƒ¼åŒæœŸã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
  });
});
```

---

## ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

### ãƒ•ã‚§ãƒ¼ã‚º 1: åŸºç›¤æ•´å‚™ï¼ˆ2-3 é€±é–“ï¼‰

| ã‚¿ã‚¹ã‚¯                   | å·¥æ•° | ä¾å­˜é–¢ä¿‚     | å®Œäº†æ¡ä»¶                         |
| ------------------------ | ---- | ------------ | -------------------------------- |
| NetInfo çµ±åˆ             | 2 æ—¥ | ãªã—         | useNetworkStatus ãŒå‹•ä½œ          |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ | 1 æ—¥ | NetInfo çµ±åˆ | å…¨ç”»é¢ã§è¡¨ç¤ºã•ã‚Œã‚‹               |
| Supabase ãƒ©ãƒƒãƒ‘ãƒ¼        | 3 æ—¥ | ãªã—         | ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒ©ãƒƒãƒ—ã•ã‚Œã‚‹ |
| ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª         | 2 æ—¥ | ãªã—         | ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãŒé˜²ãŒã‚Œã‚‹             |
| ãƒ†ã‚¹ãƒˆä½œæˆ               | 3 æ—¥ | ã™ã¹ã¦       | ã‚«ãƒãƒ¬ãƒƒã‚¸ 80%ä»¥ä¸Š               |

**æˆæœç‰©:**

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
- åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º 2: UI/UX å¼·åŒ–ï¼ˆ2-3 é€±é–“ï¼‰

| ã‚¿ã‚¹ã‚¯                      | å·¥æ•° | ä¾å­˜é–¢ä¿‚         | å®Œäº†æ¡ä»¶               |
| --------------------------- | ---- | ---------------- | ---------------------- |
| LibraryDownloads ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ | 4 æ—¥ | ãªã—             | ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆå‹•ä½œ |
| ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çµ±è¨ˆ            | 2 æ—¥ | ãªã—             | ä½¿ç”¨å®¹é‡ãŒæ­£ç¢ºã«è¡¨ç¤º   |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†ç”»é¢          | 3 æ—¥ | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çµ±è¨ˆ | ä¸€æ‹¬å‰Šé™¤ãŒå‹•ä½œ         |
| UI/UX ãƒ†ã‚¹ãƒˆ                | 2 æ—¥ | ã™ã¹ã¦           | ã‚«ãƒãƒ¬ãƒƒã‚¸ 80%ä»¥ä¸Š     |

**æˆæœç‰©:**

- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å°‚ç”¨ã‚¿ãƒ–
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†æ©Ÿèƒ½
- çµ±è¨ˆè¡¨ç¤º

### ãƒ•ã‚§ãƒ¼ã‚º 3: é«˜åº¦ãªæ©Ÿèƒ½ï¼ˆ3-4 é€±é–“ï¼‰

| ã‚¿ã‚¹ã‚¯              | å·¥æ•° | ä¾å­˜é–¢ä¿‚            | å®Œäº†æ¡ä»¶               |
| ------------------- | ---- | ------------------- | ---------------------- |
| OfflineQueueService | 5 æ—¥ | NetInfo çµ±åˆ        | ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ãŒå‹•ä½œ     |
| è‡ªå‹•åŒæœŸ            | 3 æ—¥ | OfflineQueueService | ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«åŒæœŸ |
| ç«¶åˆè§£æ±º            | 4 æ—¥ | è‡ªå‹•åŒæœŸ            | ç«¶åˆãŒé©åˆ‡ã«è§£æ±º       |
| AsyncStorage ç§»è¡Œ   | 2 æ—¥ | ãªã—                | MMKV å®Œå…¨ç§»è¡Œ          |
| ãƒãƒƒãƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰  | 3 æ—¥ | ãªã—                | è¤‡æ•°æ›²ã®åŠ¹ç‡çš„ DL      |
| çµ±åˆãƒ†ã‚¹ãƒˆ          | 4 æ—¥ | ã™ã¹ã¦              | ã™ã¹ã¦ã®ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ |

**æˆæœç‰©:**

- å®Œå…¨ãªåŒæœŸã‚·ã‚¹ãƒ†ãƒ 
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

### å…¨ä½“ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

```mermaid
gantt
    title ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œå®Ÿè£…ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
    dateFormat YYYY-MM-DD
    section Phase 1
    NetInfoçµ±åˆ                :2025-01-01, 2d
    ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼      :2025-01-03, 1d
    Supabaseãƒ©ãƒƒãƒ‘ãƒ¼            :2025-01-04, 3d
    ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª            :2025-01-07, 2d
    Phase1ãƒ†ã‚¹ãƒˆ               :2025-01-09, 3d

    section Phase 2
    LibraryDownloadsã‚¹ã‚¯ãƒªãƒ¼ãƒ³   :2025-01-12, 4d
    ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çµ±è¨ˆ            :2025-01-16, 2d
    ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†ç”»é¢          :2025-01-18, 3d
    Phase2ãƒ†ã‚¹ãƒˆ               :2025-01-21, 2d

    section Phase 3
    OfflineQueueService        :2025-01-23, 5d
    è‡ªå‹•åŒæœŸ                   :2025-01-28, 3d
    ç«¶åˆè§£æ±º                   :2025-01-31, 4d
    AsyncStorageç§»è¡Œ           :2025-02-04, 2d
    ãƒãƒƒãƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰          :2025-02-06, 3d
    çµ±åˆãƒ†ã‚¹ãƒˆ                 :2025-02-09, 4d
```

**ç·å·¥æ•°**: ç´„ 7-10 é€±é–“

---

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### æŠ€è¡“çš„ãƒªã‚¹ã‚¯

#### ãƒªã‚¹ã‚¯ 1: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ– ğŸ”´ é«˜

**å†…å®¹**: å¤§é‡ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ›²ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªèµ·å‹•ã‚„ãƒªã‚¹ãƒˆè¡¨ç¤ºãŒé…ããªã‚‹

**å½±éŸ¿**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®è‘—ã—ã„ä½ä¸‹

**è»½æ¸›ç­–**:

- FlashList ã‚’ä½¿ç”¨ã—ãŸä»®æƒ³åŒ–ãƒªã‚¹ãƒˆ
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®é…å»¶èª­ã¿è¾¼ã¿
- ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®ç¶™ç¶šçš„å®Ÿæ–½

**ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**:

```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
const metrics = {
  appStartTime: performance.now(),
  listRenderTime: 0,
  downloadTime: 0,
};
```

#### ãƒªã‚¹ã‚¯ 2: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ä¸è¶³ ğŸŸ¡ ä¸­

**å†…å®¹**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ›²ãŒå¢—ãˆã™ãã¦ãƒ‡ãƒã‚¤ã‚¹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åœ§è¿«

**å½±éŸ¿**: ã‚¢ãƒ—ãƒªã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã€ä»–ã‚¢ãƒ—ãƒªã¸ã®å½±éŸ¿

**è»½æ¸›ç­–**:

- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‰ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ãƒã‚§ãƒƒã‚¯
- è‡ªå‹•å‰Šé™¤æ©Ÿèƒ½ï¼ˆå¤ã„æ›²ã€å†ç”Ÿå›æ•°å°‘ãªã„æ›²ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è­¦å‘Šè¡¨ç¤º
- å“è³ªè¨­å®šã«ã‚ˆã‚‹å®¹é‡èª¿æ•´

**å®Ÿè£…ä¾‹**:

```typescript
async function checkStorageSpace(): Promise<boolean> {
  const info = await FileSystem.getFreeDiskStorageAsync();
  const requiredSpace = 10 * 1024 * 1024; // 10MB
  return info > requiredSpace;
}
```

#### ãƒªã‚¹ã‚¯ 3: åŒæœŸç«¶åˆ ğŸŸ¡ ä¸­

**å†…å®¹**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æ“ä½œãŒã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ã®ãƒ‡ãƒ¼ã‚¿ã¨ç«¶åˆ

**å½±éŸ¿**: ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆã€æ“ä½œã®å–ªå¤±

**è»½æ¸›ç­–**:

- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã®ç«¶åˆæ¤œå‡º
- Last-Write-Wins æˆ¦ç•¥
- é‡è¦ãªæ“ä½œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª
- ç«¶åˆãƒ­ã‚°ã®ä¿å­˜ã¨åˆ†æ

#### ãƒªã‚¹ã‚¯ 4: NetInfo ã®ä¿¡é ¼æ€§ ğŸŸ¡ ä¸­

**å†…å®¹**: NetInfo ãŒä¸æ­£ç¢ºãªçŠ¶æ…‹ã‚’è¿”ã™å¯èƒ½æ€§

**å½±éŸ¿**: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åˆ¤å®šã®èª¤ã‚Š

**è»½æ¸›ç­–**:

- å®Ÿéš›ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã®äºŒé‡ç¢ºèª
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã¸ã®å½±éŸ¿

#### å½±éŸ¿ 1: å­¦ç¿’æ›²ç·š

**å†…å®¹**: æ–°ã—ã„ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**å¯¾ç­–**:

- ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
- æ©Ÿèƒ½èª¬æ˜ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
- ãƒ˜ãƒ«ãƒ—ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### å½±éŸ¿ 2: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œ

**å†…å®¹**: AsyncStorage ã‹ã‚‰ MMKV ã¸ã®ç§»è¡Œæ™‚ã®ãƒ‡ãƒ¼ã‚¿æå¤±ãƒªã‚¹ã‚¯

**å¯¾ç­–**:

- æ®µéšçš„ç§»è¡Œ
- ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½

#### å½±éŸ¿ 3: ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»

**å†…å®¹**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸã«ã‚ˆã‚‹ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»å¢—åŠ 

**å¯¾ç­–**:

- åŒæœŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®æœ€é©åŒ–
- Wi-Fi æ¥ç¶šæ™‚ã®ã¿ã®åŒæœŸã‚ªãƒ—ã‚·ãƒ§ãƒ³
- ãƒãƒƒãƒ†ãƒªãƒ¼çŠ¶æ…‹ã®ç›£è¦–

---

## æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰

### 1. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½åˆ©ç”¨ç‡

**æ¸¬å®šæ–¹æ³•**:

```typescript
// ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹å®Ÿè£…ä¾‹
analytics.logEvent("offline_mode_used", {
  duration: offlineSession.duration,
  songs_played: offlineSession.songsPlayed,
  operations_queued: offlineSession.operationsQueued,
});
```

**ç›®æ¨™**:

- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½åˆ©ç”¨ç‡: **30%ä»¥ä¸Š**ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® 30%ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ï¼‰
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å†ç”Ÿç‡: **15%ä»¥ä¸Š**ï¼ˆå…¨å†ç”Ÿã‚»ãƒƒã‚·ãƒ§ãƒ³ã® 15%ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ›²ã®å¹³å‡ä¿æŒæ•°: **20 æ›²ä»¥ä¸Š**

### 2. ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡

**æ¸¬å®šæ–¹æ³•**:

```typescript
// ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
errorTracker.captureException(error, {
  context: "offline_sync",
  networkState: networkStatus.isConnected,
  queueSize: queueService.getQueue().length,
});
```

**ç›®æ¨™**:

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹ã‚¯ãƒ©ãƒƒã‚·ãƒ¥: **95%å‰Šæ¸›**ï¼ˆç¾çŠ¶æ¯”ï¼‰
- åŒæœŸå¤±æ•—ç‡: **5%ä»¥ä¸‹**
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—ç‡: **10%ä»¥ä¸‹**

### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦

**æ¸¬å®šæ–¹æ³•**:

- ã‚¢ãƒ—ãƒªå†… NPS èª¿æŸ»
- ãƒ¬ãƒ“ãƒ¥ãƒ¼è©•ä¾¡ã®æ¨ç§»
- ã‚µãƒãƒ¼ãƒˆå•ã„åˆã‚ã›æ•°

**ç›®æ¨™**:

- ã‚¢ãƒ—ãƒªã‚¹ãƒˆã‚¢è©•ä¾¡: **4.5 ä»¥ä¸Š**ï¼ˆ5 ç‚¹æº€ç‚¹ï¼‰
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½æº€è¶³åº¦: **80%ä»¥ä¸Š**
- ã‚µãƒãƒ¼ãƒˆå•ã„åˆã‚ã›å‰Šæ¸›: **40%æ¸›**ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³é–¢é€£ï¼‰

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

**æ¸¬å®šæ–¹æ³•**:

```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
performance.measure("list-render", "start", "end");
const measure = performance.getEntriesByName("list-render")[0];
console.log(`Render time: ${measure.duration}ms`);
```

**ç›®æ¨™**:

- ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚é–“: **3 ç§’ä»¥å†…**ï¼ˆ100 æ›²ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ï¼‰
- ãƒªã‚¹ãƒˆæç”»æ™‚é–“: **16ms ä»¥ä¸‹**ï¼ˆ60fps ç¶­æŒï¼‰
- åŒæœŸå‡¦ç†æ™‚é–“: **5 ç§’ä»¥å†…**ï¼ˆ10 æ“ä½œã¾ã§ï¼‰
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: **200MB ä»¥ä¸‹**ï¼ˆé€šå¸¸æ™‚ï¼‰

### 5. ãƒ‡ãƒ¼ã‚¿åŠ¹ç‡æ€§

**æ¸¬å®šæ–¹æ³•**:

```typescript
// ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨é‡ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
const dataUsage = {
  cacheHitRate: cacheHits / totalRequests,
  bandwidthSaved: cachedDataSize,
  unnecessaryRequests: redundantRequests,
};
```

**ç›®æ¨™**:

- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡: **70%ä»¥ä¸Š**
- ä¸è¦ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰Šæ¸›: **60%æ¸›**
- ãƒ‡ãƒ¼ã‚¿è»¢é€é‡å‰Šæ¸›: **50%æ¸›**ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ã«ã‚ˆã‚Šï¼‰

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¾‹

```typescript
// ç®¡ç†ç”»é¢ç”¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
interface OfflineMetrics {
  // åˆ©ç”¨çŠ¶æ³
  totalDownloads: number;
  activeOfflineUsers: number;
  averageSongsPerUser: number;

  // ã‚¨ãƒ©ãƒ¼ç‡
  syncSuccessRate: number;
  downloadSuccessRate: number;
  crashRate: number;

  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
  averageStartupTime: number;
  averageRenderTime: number;
  averageSyncTime: number;

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦
  npsScore: number;
  appStoreRating: number;
  supportTickets: number;
}
```

---

## å‚è€ƒè³‡æ–™

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. **æ—¢å­˜èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ**

   - [ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½èª¿æŸ»çµæœ](GEMINI.md) - ç¾çŠ¶åˆ†æã®è©³ç´°

2. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
   - [README.md](README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
   - [package.json](package.json) - ä¾å­˜é–¢ä¿‚

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

1. **@react-native-community/netinfo** (v11.3.1)

   - [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/react-native-netinfo/react-native-netinfo)
   - [API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://github.com/react-native-netinfo/react-native-netinfo/blob/master/README.md#api)
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®æ¤œçŸ¥ã¨ç›£è¦–

2. **react-native-mmkv** (v2.12.2)

   - [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/mrousavy/react-native-mmkv)
   - [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯](https://github.com/mrousavy/react-native-mmkv#benchmark)
   - é«˜é€Ÿãƒ»é«˜ä¿¡é ¼æ€§ã®ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

3. **@tanstack/react-query** (v5.66.0)

   - [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://tanstack.com/query/latest)
   - [ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã‚¬ã‚¤ãƒ‰](https://tanstack.com/query/latest/docs/react/guides/offline)
   - [æ°¸ç¶šåŒ–ã‚¬ã‚¤ãƒ‰](https://tanstack.com/query/latest/docs/react/plugins/persistQueryClient)

4. **react-native-track-player** (v4.1.1)

   - [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://react-native-track-player.js.org/)
   - [API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://react-native-track-player.js.org/documentation/api/)
   - ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå†ç”Ÿã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†

5. **expo-file-system** (v18.0.12)
   - [Expo ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.expo.dev/versions/latest/sdk/filesystem/)
   - ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ä¿å­˜ãƒ»å‰Šé™¤

#### Supabase

6. **@supabase/supabase-js** (v2.48.1)
   - [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://supabase.com/docs/reference/javascript/introduction)
   - [èªè¨¼ã‚¬ã‚¤ãƒ‰](https://supabase.com/docs/guides/auth)
   - [ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸](https://supabase.com/docs/reference/javascript/initializing#custom-storage)

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### React Native ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ

1. **"Building Offline-First Apps with React Native"**

   - [Medium è¨˜äº‹](https://medium.com/@rossbulat/offline-first-apps-with-react-native-75f8c8f7a24d)
   - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¢ãƒ—ãƒªã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

2. **"React Native Performance Optimization"**

   - [React Native å…¬å¼](https://reactnative.dev/docs/performance)
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

3. **"Testing React Native Apps"**
   - [Testing Library](https://testing-library.com/docs/react-native-testing-library/intro)
   - TDD ã¨ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

#### ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³

4. **"Conflict-Free Replicated Data Types (CRDTs)"**

   - [ç ”ç©¶è«–æ–‡](https://arxiv.org/abs/1805.06358)
   - åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ç«¶åˆè§£æ±º

5. **"Offline-First Database Design"**
   - [PouchDB Guide](https://pouchdb.com/guides/conflicts.html)
   - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ DB ã®ç«¶åˆå‡¦ç†

#### UI/UX ãƒ‡ã‚¶ã‚¤ãƒ³

6. **"Designing for Offline"**

   - [Google Web Fundamentals](https://developers.google.com/web/fundamentals/instant-and-offline/offline-ux)
   - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã® UX è¨­è¨ˆåŸå‰‡

7. **"Material Design - Connectivity"**
   - [Material Design](https://m2.material.io/design/connectivity/connectivity.html)
   - æ¥ç¶šçŠ¶æ…‹ã®è¡¨ç¾æ–¹æ³•

### ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

#### GitHub ãƒªãƒã‚¸ãƒˆãƒª

1. **spotify/mobius** - Spotify ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œãƒ‘ã‚¿ãƒ¼ãƒ³
2. **expo/examples** - Expo ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½å®Ÿè£…ä¾‹
3. **TanStack Query Examples** - React Query ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å®Ÿè£…ä¾‹

#### å®Ÿè£…å‚è€ƒã‚³ãƒ¼ãƒ‰

```typescript
// NetInfo + React Query çµ±åˆã®å®Ÿä¾‹
import { onlineManager } from "@tanstack/react-query";
import NetInfo from "@react-native-community/netinfo";

onlineManager.setEventListener((setOnline) => {
  return NetInfo.addEventListener((state) => {
    setOnline(state.isConnected ?? false);
  });
});
```

```typescript
// MMKV + Supabase çµ±åˆã®å®Ÿä¾‹
import { createClient } from "@supabase/supabase-js";
import { MMKV } from "react-native-mmkv";

const storage = new MMKV();

const supabase = createClient(url, key, {
  auth: {
    storage: {
      getItem: (key) => storage.getString(key) ?? null,
      setItem: (key, value) => storage.set(key, value),
      removeItem: (key) => storage.delete(key),
    },
  },
});
```

---

## ä»˜éŒ²

### ç”¨èªé›†

- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’å‰æã¨ã—ãŸè¨­è¨ˆæ€æƒ³
- **ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°**: æ“ä½œã‚’é †åºä»˜ããƒªã‚¹ãƒˆã«ä¿å­˜ã™ã‚‹ã“ã¨
- **åŒæœŸ**: ãƒ­ãƒ¼ã‚«ãƒ«ã¨ãƒªãƒ¢ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€è‡´ã•ã›ã‚‹ã“ã¨
- **ç«¶åˆ**: åŒã˜ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹è¤‡æ•°ã®å¤‰æ›´ãŒè¡çªã™ã‚‹ã“ã¨
- **æ°¸ç¶šåŒ–**: ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šçš„ã«ä¿å­˜ã™ã‚‹ã“ã¨
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ã§ããŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‰²åˆ

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

```typescript
// ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCase (LibraryDownloads.tsx)
- Hooks: camelCase + use prefix (useNetworkStatus.ts)
- ã‚µãƒ¼ãƒ“ã‚¹: PascalCase + Service suffix (OfflineQueueService.ts)
- ãƒ†ã‚¹ãƒˆ: å…ƒãƒ•ã‚¡ã‚¤ãƒ«å + .test.ts

// é–¢æ•°å‘½åè¦å‰‡
- é€šå¸¸é–¢æ•°: camelCase (downloadSong)
- React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCase (OfflineIndicator)
- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯: camelCase + use prefix (useDownloadStats)

// å®šæ•°å‘½åè¦å‰‡
- UPPER_SNAKE_CASE (ERROR_MESSAGES, CACHED_QUERIES)
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

#### å•é¡Œ: NetInfo ãŒä¸æ­£ç¢ºãªçŠ¶æ…‹ã‚’è¿”ã™

**ç—‡çŠ¶**: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®åˆ¤å®šãŒå®Ÿéš›ã®çŠ¶æ…‹ã¨ä¸€è‡´ã—ãªã„

**åŸå› **: ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ã®å•é¡Œã€ã¾ãŸã¯ NetInfo ã®åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**è§£æ±ºç­–**:

```typescript
// å®Ÿéš›ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ç¢ºèª
async function verifyNetworkConnection(): Promise<boolean> {
  try {
    const response = await fetch("https://www.google.com", {
      method: "HEAD",
      cache: "no-store",
    });
    return response.ok;
  } catch {
    return false;
  }
}
```

#### å•é¡Œ: åŒæœŸãŒå®Œäº†ã—ãªã„

**ç—‡çŠ¶**: ã‚­ãƒ¥ãƒ¼ã«æ“ä½œãŒæ®‹ã‚Šç¶šã‘ã‚‹

**åŸå› **: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã€ã¾ãŸã¯èªè¨¼ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**:

1. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
2. ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
3. æ‰‹å‹•ã§ã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰

```typescript
// ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
async function debugQueue() {
  const queue = queueService.getQueue();
  console.log("Queue contents:", JSON.stringify(queue, null, 2));

  for (const op of queue) {
    console.log(`Operation ${op.id}:`);
    console.log(`  Type: ${op.type}`);
    console.log(`  Retry count: ${op.retryCount}`);
    console.log(`  Timestamp: ${new Date(op.timestamp).toISOString()}`);
  }
}
```

---

## ã¾ã¨ã‚

æœ¬è¨ˆç”»æ›¸ã¯ã€badwave-mobile ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ**ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’æä¾›ã—ã¾ã™ã€‚

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: 3 ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ã¦ç€å®Ÿã«å®Ÿè£…
2. **TDD æº–æ‹ **: ã™ã¹ã¦ã®æ©Ÿèƒ½ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆé–‹ç™º
3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸­å¿ƒ**: UX ã‚’æœ€å„ªå…ˆã«è€ƒæ…®ã—ãŸè¨­è¨ˆ
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–**: å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã‚‚å¿«é©ã«å‹•ä½œ
5. **æ‹¡å¼µæ€§**: å°†æ¥çš„ãªæ©Ÿèƒ½è¿½åŠ ã‚’è€ƒæ…®ã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **è¨ˆç”»ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒãƒ¼ãƒ ã§ç¢ºèª
2. **å„ªå…ˆé †ä½ã®èª¿æ•´**: å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚§ãƒ¼ã‚ºã®é †åºã‚’å¤‰æ›´
3. **å®Ÿè£…é–‹å§‹**: ãƒ•ã‚§ãƒ¼ã‚º 1 ã‹ã‚‰é †æ¬¡å®Ÿè£…
4. **ç¶™ç¶šçš„æ”¹å–„**: KPI ã‚’ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã—ãªãŒã‚‰æ”¹å–„

ã“ã®è¨ˆç”»ã«ã‚ˆã‚Šã€badwave-mobile ã¯**æ¥­ç•Œæœ€é«˜æ°´æº–ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³éŸ³æ¥½ä½“é¨“**ã‚’æä¾›ã§ãã‚‹ã‚¢ãƒ—ãƒªã«ãªã‚Šã¾ã™ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2025-01-16
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æ‰¿èªå¾…ã¡
